# Netlify build configuration for Next.js monorepo
[build]
  # Build from repo root to support npm workspaces
  base = ""
  # Install dependencies and build frontend
  # Using workspace command ensures proper dependency resolution
  command = "npm ci && npm run --workspace=apps/frontend build"
  # Next.js plugin automatically handles publishing, but we specify for clarity
  # The plugin will look for .next in the directory where Next.js was built
  publish = "apps/frontend/.next"

[build.environment]
  NODE_VERSION = "20"
  NEXT_TELEMETRY_DISABLED = "1"
  # Ensure npm workspaces are properly handled
  NPM_CONFIG_AUDIT = "false"
  NPM_CONFIG_FUND = "false"

# Next.js plugin for SSR, API routes, and optimized deployments
# The plugin automatically detects Next.js and handles routing
# For monorepos, the plugin works with the build output in apps/frontend/.next
[[plugins]]
  package = "@netlify/plugin-nextjs"
